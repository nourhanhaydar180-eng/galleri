

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Scanner with Interactive Table</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        /* الأساسيات */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #2d936c;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-color: #dee2e6;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --success-light: #d4edda;
            --error-light: #f8d7da;
            --duplicate-light: #fff3cd;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark-color);
            line-height: 1.6;
            padding: 10px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* الهيدر */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.2rem 1.5rem;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .logo i {
            font-size: 1.8rem;
        }
        
        /* التنقل الرئيسي */
        .nav-tabs {
            display: flex;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 10px 15px;
            background: transparent;
            border: none;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .tab-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .tab-btn.active {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        /* المحتوى الرئيسي */
        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }
        
        .tab-content {
            display: none;
            flex-direction: column;
            gap: 20px;
        }
        
        .tab-content.active {
            display: flex;
        }
        
        /* قسم الماسح الضوئي */
        .scanner-section {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .scanner-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        #reader {
            width: 100%;
            max-width: 500px;
            border-radius: 10px;
            overflow: hidden;
            border: 3px solid var(--border-color);
            position: relative;
            transition: all 0.3s ease;
        }
        
        .scanner-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            color: white;
            font-weight: bold;
            z-index: 100;
            border-radius: 10px;
        }
        
        .scanner-overlay.success {
            background-color: rgba(40, 167, 69, 0.8);
            display: flex;
        }
        
        .scanner-overlay.error {
            background-color: rgba(220, 53, 69, 0.8);
            display: flex;
        }
        
        .scanner-overlay.duplicate {
            background-color: rgba(255, 193, 7, 0.8);
            display: flex;
        }
        
        .scanner-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        /* مؤشرات الضوء */
        .scanner-indicators {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }
        
        .indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .indicator-light {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #e0e0e0;
            border: 2px solid #ccc;
            transition: all 0.3s ease;
        }
        
        .indicator-light.success {
            background-color: var(--success-color);
            box-shadow: 0 0 15px var(--success-color);
        }
        
        .indicator-light.error {
            background-color: var(--danger-color);
            box-shadow: 0 0 15px var(--danger-color);
        }
        
        .indicator-light.duplicate {
            background-color: var(--warning-color);
            box-shadow: 0 0 15px var(--warning-color);
        }
        
        .indicator-label {
            font-size: 0.8rem;
            color: var(--dark-color);
            font-weight: 600;
        }
        
        /* قسم الجدول */
        .sheet-section {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .sheet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .sheet-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        /* عناصر التحكم */
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c82333;
        }
        
        .btn-accent {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-accent:hover {
            background-color: #218c68;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }
        
        .btn-warning:hover {
            background-color: #e0a800;
        }
        
        /* الجدول */
        .table-container {
            overflow-x: auto;
            flex: 1;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        th {
            background-color: #f1f5f9;
            font-weight: 700;
            color: var(--dark-color);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        td.editable {
            cursor: text;
            position: relative;
        }
        
        td.editable:focus {
            outline: 2px solid var(--primary-color);
            background-color: white;
        }
        
        .actions-cell {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: var(--dark-color);
            transition: color 0.3s;
        }
        
        .action-btn.edit:hover {
            color: var(--primary-color);
        }
        
        .action-btn.delete:hover {
            color: var(--danger-color);
        }
        
        /* قسم المشاركة */
        .share-section {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
        }
        
        .share-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }
        
        .share-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .share-link {
            display: flex;
            gap: 10px;
            align-items: center;
            flex: 1;
            min-width: 250px;
        }
        
        .share-link input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        /* الفوتر */
        footer {
            text-align: center;
            padding: 20px;
            color: #6c757d;
            font-size: 0.9rem;
            margin-top: 20px;
        }
        
        /* رسائل */
        .message {
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: none;
        }
        
        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        .message.warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            display: block;
        }
        
        /* تصميم متجاوب */
        @media (max-width: 1200px) {
            .container {
                max-width: 95%;
            }
        }
        
        @media (max-width: 992px) {
            .header-top {
                flex-direction: column;
                align-items: stretch;
            }
            
            .logo {
                justify-content: center;
            }
            
            .controls {
                justify-content: center;
            }
            
            .sheet-header {
                flex-direction: column;
                align-items: stretch;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            header, .scanner-section, .sheet-section, .share-section {
                padding: 15px;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                padding: 12px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .tab-btn:last-child {
                border-bottom: none;
            }
            
            .scanner-controls {
                flex-direction: column;
                width: 100%;
            }
            
            .scanner-controls .btn {
                width: 100%;
                justify-content: center;
            }
            
            .controls {
                width: 100%;
                justify-content: center;
            }
            
            .btn {
                flex: 1;
                justify-content: center;
                min-width: 140px;
                padding: 12px;
            }
            
            th, td {
                padding: 8px 10px;
                font-size: 0.9rem;
            }
            
            .share-options {
                flex-direction: column;
            }
            
            .share-link {
                min-width: 100%;
            }
            
            table {
                min-width: 400px;
            }
            
            .scanner-indicators {
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .indicator-light {
                width: 35px;
                height: 35px;
            }
        }
        
        @media (max-width: 480px) {
            .logo {
                font-size: 1.2rem;
            }
            
            .logo i {
                font-size: 1.5rem;
            }
            
            .sheet-title {
                font-size: 1.3rem;
            }
            
            .btn {
                min-width: 120px;
                padding: 10px;
                font-size: 0.85rem;
            }
            
            th, td {
                padding: 6px 8px;
                font-size: 0.85rem;
            }
            
            #reader {
                max-width: 100%;
            }
            
            .indicator-light {
                width: 30px;
                height: 30px;
            }
            
            .indicator-label {
                font-size: 0.7rem;
            }
        }
        
        @media (max-width: 360px) {
            .controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .tab-btn {
                font-size: 0.9rem;
                padding: 10px 5px;
            }
            
            .scanner-indicators {
                gap: 10px;
            }
        }
        
        /* تأثيرات إضافية */
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(45, 147, 108, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(45, 147, 108, 0); }
            100% { box-shadow: 0 0 0 0 rgba(45, 147, 108, 0); }
        }
        
        .highlight {
            background-color: #fff3cd !important;
            transition: background-color 1.5s;
        }
        
        /* شاشة التحميل */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* إشعارات صغيرة */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.3s, transform 0.3s;
            max-width: 300px;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .notification.success {
            background-color: var(--success-color);
        }
        
        .notification.error {
            background-color: var(--danger-color);
        }
        
        .notification.info {
            background-color: var(--primary-color);
        }
        
        @media (max-width: 768px) {
            .notification {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }
        
        /* تأثيرات الضوء */
        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .flashing {
            animation: flash 0.5s ease-in-out 3;
        }
        
        /* مؤشرات الصوت */
        .audio-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .audio-toggle {
            padding: 8px 15px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }
        
        .audio-toggle.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
    </style>
</head>
<body>
    <header>
        <div class="header-top">
            <div class="logo">
                <i class="fas fa-shopping-cart"></i>
                <span>Product Scanner System</span>
            </div>
            <div class="controls">
                <button class="btn btn-accent" id="clearAllBtn">
                    <i class="fas fa-trash-alt"></i> Clear All
                </button>
                <button class="btn btn-success" id="exportBtn">
                    <i class="fas fa-file-export"></i> Export Table
                </button>
            </div>
        </div>
        
        <div class="nav-tabs">
            <button class="tab-btn active" data-tab="scanner-tab">
                <i class="fas fa-camera"></i> Scanner
            </button>
            <button class="tab-btn" data-tab="sheet-tab">
                <i class="fas fa-table"></i> Interactive Table
            </button>
            <button class="tab-btn" data-tab="share-tab">
                <i class="fas fa-share-alt"></i> Share Table
            </button>
        </div>
    </header>
    
    <div class="container">
        <!-- رسائل النظام -->
        <div class="message" id="message"></div>
        
        <!-- تبويب الماسح الضوئي -->
        <div class="tab-content active" id="scanner-tab">
            <div class="scanner-section">
                <h2><i class="fas fa-qrcode"></i> Scan Products with Camera</h2>
                <p>Use the camera to scan product codes (barcode, QR code) and they will be automatically added to the table.</p>
                
                <div class="scanner-container">
                    <div id="reader" class="pulse">
                        <!-- طبقة التغطية للضوء -->
                        <div class="scanner-overlay success" id="scannerSuccessOverlay">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="scanner-overlay error" id="scannerErrorOverlay">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="scanner-overlay duplicate" id="scannerDuplicateOverlay">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                    </div>
                    
                    <!-- مؤشرات الضوء -->
                    <div class="scanner-indicators">
                        <div class="indicator">
                            <div class="indicator-light" id="successLight"></div>
                            <div class="indicator-label">Successful Scan</div>
                        </div>
                        <div class="indicator">
                            <div class="indicator-light" id="errorLight"></div>
                            <div class="indicator-label">Error</div>
                        </div>
                        <div class="indicator">
                            <div class="indicator-light" id="duplicateLight"></div>
                            <div class="indicator-label">Duplicate</div>
                        </div>
                    </div>
                    
                    <!-- عناصر تحكم الصوت -->
                    <div class="audio-controls">
                        <div class="audio-toggle active" id="toggleSounds">
                            <i class="fas fa-volume-up"></i> Sounds ON
                        </div>
                        <div class="audio-toggle" id="toggleLights">
                            <i class="fas fa-lightbulb"></i> Lights ON
                        </div>
                    </div>
                    
                    <div class="scanner-controls">
                        <button class="btn btn-primary" id="startScannerBtn">
                            <i class="fas fa-play"></i> Start Scanner
                        </button>
                        <button class="btn btn-danger" id="stopScannerBtn">
                            <i class="fas fa-stop"></i> Stop Scanner
                        </button>
                        <button class="btn btn-accent" id="addManualBtn">
                            <i class="fas fa-plus"></i> Add Manually
                        </button>
                    </div>
                </div>
                
                <div id="scannerResult" style="text-align: center; margin-top: 15px; font-weight: 600;"></div>
            </div>
            
            <div class="sheet-section">
                <div class="sheet-header">
                    <div class="sheet-title">Recently Added Products</div>
                    <div class="controls">
                        <button class="btn btn-primary" id="addRowBtn">
                            <i class="fas fa-plus"></i> Add Row
                        </button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="productsTable">
                        <thead>
                            <tr>
                                <th width="5%">#</th>
                                <th width="20%">Product Code</th>
                                <th width="25%">Product Name</th>
                                <th width="15%">Price</th>
                                <th width="15%">Quantity</th>
                                <th width="15%">Total</th>
                                <th width="10%">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- الصفوف ستضاف هنا ديناميكياً -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- تبويب الجدول التفاعلي -->
        <div class="tab-content" id="sheet-tab">
            <div class="sheet-section">
                <div class="sheet-header">
                    <div class="sheet-title">Complete Products Table</div>
                    <div class="controls">
                        <button class="btn btn-primary" id="addRowSheetBtn">
                            <i class="fas fa-plus"></i> Add Row
                        </button>
                        <button class="btn btn-success" id="calculateTotalBtn">
                            <i class="fas fa-calculator"></i> Calculate Total
                        </button>
                        <button class="btn btn-warning" id="saveDataBtn">
                            <i class="fas fa-save"></i> Save Data
                        </button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="fullSheetTable">
                        <thead>
                            <tr>
                                <th width="5%">#</th>
                                <th width="15%">Product Code</th>
                                <th width="25%">Product Name</th>
                                <th width="15%">Category</th>
                                <th width="10%">Price</th>
                                <th width="10%">Quantity</th>
                                <th width="10%">Total</th>
                                <th width="10%">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="fullSheetBody">
                            <!-- سيتم ملؤه بنفس بيانات productsTable -->
                        </tbody>
                        <tfoot id="tableFooter">
                            <tr>
                                <td colspan="6" style="text-align: right; font-weight: 700;">Grand Total:</td>
                                <td id="grandTotal" style="font-weight: 700;">0.00</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- تبويب المشاركة -->
        <div class="tab-content" id="share-tab">
            <div class="share-section">
                <h2><i class="fas fa-share-alt"></i> Share Products Table</h2>
                <p>You can share the products table with others using the following links:</p>
                
                <div class="share-controls">
                    <div class="share-options">
                        <div class="share-link">
                            <input type="text" id="jsonLink" readonly value="Link will be generated after saving the table">
                            <button class="btn btn-primary" id="copyJsonBtn">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </div>
                        
                        <div class="share-link">
                            <input type="text" id="csvLink" readonly value="Link will be generated after saving the table">
                            <button class="btn btn-primary" id="copyCsvBtn">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </div>
                    </div>
                    
                    <div class="controls" style="justify-content: center;">
                        <button class="btn btn-success" id="generateLinksBtn">
                            <i class="fas fa-link"></i> Generate Share Links
                        </button>
                        <button class="btn btn-accent" id="saveToFileBtn">
                            <i class="fas fa-download"></i> Save as File
                        </button>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
                        <h3><i class="fas fa-info-circle"></i> Sharing Information</h3>
                        <p>• Sharing links are valid for 30 days.</p>
                        <p>• Recipients can view and download the table but cannot edit it.</p>
                        <p>• To enable shared editing, save the table to Google Sheets.</p>
                        
                        <div style="text-align: center; margin-top: 15px;">
                            <button class="btn btn-primary" id="openGoogleSheetsBtn">
                                <i class="fab fa-google"></i> Open in Google Sheets
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>© 2023 Product Scanner System | Developed for easy product scanning and management</p>
    </footer>

    <!-- إشعارات صغيرة -->
    <div id="notification" class="notification"></div>

    <!-- عناصر الصوت المخفية -->
    <audio id="successSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
    </audio>
    <audio id="errorSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" type="audio/mpeg">
    </audio>
    <audio id="duplicateSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-warning-alarm-buzzer-1551.mp3" type="audio/mpeg">
    </audio>

    <script>
        // بيانات التطبيق
        let products = [];
        let rowCounter = 1;
        let scannerActive = false;
        let html5QrCode;
        let soundsEnabled = true;
        let lightsEnabled = true;
        
        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            // تحميل البيانات المحفوظة من localStorage
            loadSavedData();
            
            initTabs();
            initTable();
            initScanner();
            initButtons();
            initAudioControls();
            updateFullSheetTable();
            calculateGrandTotal();
            
            // إظهار إشعار التحميل
            showNotification('Data loaded from local storage', 'success');
        });
        
        // تهيئة عناصر تحكم الصوت
        function initAudioControls() {
            const toggleSoundsBtn = document.getElementById('toggleSounds');
            const toggleLightsBtn = document.getElementById('toggleLights');
            
            toggleSoundsBtn.addEventListener('click', function() {
                soundsEnabled = !soundsEnabled;
                if (soundsEnabled) {
                    this.classList.add('active');
                    this.innerHTML = '<i class="fas fa-volume-up"></i> Sounds ON';
                } else {
                    this.classList.remove('active');
                    this.innerHTML = '<i class="fas fa-volume-mute"></i> Sounds OFF';
                }
            });
            
            toggleLightsBtn.addEventListener('click', function() {
                lightsEnabled = !lightsEnabled;
                if (lightsEnabled) {
                    this.classList.add('active');
                    this.innerHTML = '<i class="fas fa-lightbulb"></i> Lights ON';
                } else {
                    this.classList.remove('active');
                    this.innerHTML = '<i class="fas fa-lightbulb"></i> Lights OFF';
                }
            });
        }
        
        // تشغيل صوت النجاح
        function playSuccessSound() {
            if (!soundsEnabled) return;
            
            const sound = document.getElementById('successSound');
            sound.currentTime = 0;
            sound.play().catch(e => {
                console.log("Audio play failed:", e);
                // إنشاء صوت بديل إذا فشل تحميل الصوت
                playFallbackSound('success');
            });
        }
        
        // تشغيل صوت الخطأ
        function playErrorSound() {
            if (!soundsEnabled) return;
            
            const sound = document.getElementById('errorSound');
            sound.currentTime = 0;
            sound.play().catch(e => {
                console.log("Audio play failed:", e);
                playFallbackSound('error');
            });
        }
        
        // تشغيل صوت التكرار
        function playDuplicateSound() {
            if (!soundsEnabled) return;
            
            const sound = document.getElementById('duplicateSound');
            sound.currentTime = 0;
            sound.play().catch(e => {
                console.log("Audio play failed:", e);
                playFallbackSound('duplicate');
            });
        }
        
        // تشغيل صوت بديل باستخدام Web Audio API
        function playFallbackSound(type) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                if (type === 'success') {
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } else if (type === 'error') {
                    oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.8);
                } else if (type === 'duplicate') {
                    oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(400, audioContext.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                }
            } catch (e) {
                console.log("Fallback audio failed:", e);
            }
        }
        
        // تفعيل ضوء النجاح
        function activateSuccessLight() {
            if (!lightsEnabled) return;
            
            const light = document.getElementById('successLight');
            const overlay = document.getElementById('scannerSuccessOverlay');
            
            // تفعيل الضوء
            light.classList.add('success');
            light.classList.add('flashing');
            
            // إظهار الطبقة العلوية
            overlay.style.display = 'flex';
            
            // إزالة التأثير بعد ثانيتين
            setTimeout(() => {
                light.classList.remove('flashing');
                overlay.style.display = 'none';
            }, 2000);
            
            // إطفاء الضوء بعد 3 ثوان
            setTimeout(() => {
                light.classList.remove('success');
            }, 3000);
        }
        
        // تفعيل ضوء الخطأ
        function activateErrorLight() {
            if (!lightsEnabled) return;
            
            const light = document.getElementById('errorLight');
            const overlay = document.getElementById('scannerErrorOverlay');
            
            light.classList.add('error');
            light.classList.add('flashing');
            overlay.style.display = 'flex';
            
            setTimeout(() => {
                light.classList.remove('flashing');
                overlay.style.display = 'none';
            }, 2000);
            
            setTimeout(() => {
                light.classList.remove('error');
            }, 3000);
        }
        
        // تفعيل ضوء التكرار
        function activateDuplicateLight() {
            if (!lightsEnabled) return;
            
            const light = document.getElementById('duplicateLight');
            const overlay = document.getElementById('scannerDuplicateOverlay');
            
            light.classList.add('duplicate');
            light.classList.add('flashing');
            overlay.style.display = 'flex';
            
            setTimeout(() => {
                light.classList.remove('flashing');
                overlay.style.display = 'none';
            }, 2000);
            
            setTimeout(() => {
                light.classList.remove('duplicate');
            }, 3000);
        }
        
        // تحميل البيانات المحفوظة
        function loadSavedData() {
            const savedData = localStorage.getItem('productScannerData');
            if (savedData) {
                try {
                    products = JSON.parse(savedData);
                    rowCounter = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
                    
                    // ملء الجدول بالبيانات المحفوظة
                    products.forEach(product => {
                        addRowToTable(product, false);
                    });
                    
                    console.log(`Loaded ${products.length} products from storage`);
                } catch (e) {
                    console.error('Error loading saved data:', e);
                    products = [];
                    rowCounter = 1;
                }
            }
        }
        
        // حفظ البيانات تلقائياً
        function saveDataToStorage() {
            try {
                localStorage.setItem('productScannerData', JSON.stringify(products));
                console.log(`Saved ${products.length} products to storage`);
                
                // إظهار إشعار حفظ صغير
                showNotification('Data saved automatically', 'info');
                return true;
            } catch (e) {
                console.error('Error saving data:', e);
                showNotification('Error saving data', 'error');
                return false;
            }
        }
        
        // تهيئة نظام التبويب
        function initTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // إزالة النشاط من جميع الأزرار والمحتويات
                    tabBtns.forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // إضافة النشاط للزر والمحتوى المحدد
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }
        
        // تهيئة الجدول
        function initTable() {
            const tableBody = document.getElementById('tableBody');
            
            // إضافة حدث للحذف
            tableBody.addEventListener('click', function(e) {
                if (e.target.closest('.action-btn.delete')) {
                    const row = e.target.closest('tr');
                    const rowId = parseInt(row.cells[0].textContent);
                    
                    if (confirm(`Delete product #${rowId}?`)) {
                        // إزالة المنتج من المصفوفة
                        const index = products.findIndex(p => p.id === rowId);
                        if (index !== -1) {
                            products.splice(index, 1);
                        }
                        
                        row.remove();
                        updateRowNumbers();
                        updateFullSheetTable();
                        calculateGrandTotal();
                        saveDataToStorage();
                        showMessage('Product deleted successfully', 'success');
                    }
                }
                
                // تحويل الخلايا القابلة للتحرير
                if (e.target.classList.contains('editable')) {
                    makeCellEditable(e.target);
                }
            });
            
            // تحديث أرقام الصفوف
            updateRowNumbers();
        }
        
        // جعل الخلية قابلة للتحرير
        function makeCellEditable(cell) {
            const originalValue = cell.textContent;
            const field = cell.getAttribute('data-field');
            const row = cell.closest('tr');
            const rowId = parseInt(row.cells[0].textContent);
            
            // إنشاء حقل إدخال
            const input = document.createElement('input');
            input.type = 'text';
            input.value = originalValue;
            input.style.width = '100%';
            input.style.border = 'none';
            input.style.padding = '5px';
            input.style.fontSize = 'inherit';
            input.style.fontFamily = 'inherit';
            
            // مسح محتوى الخلية وإضافة حقل الإدخال
            cell.textContent = '';
            cell.appendChild(input);
            input.focus();
            
            // حفظ التغييرات عند الضغط على Enter
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    finishEditing(cell, input.value, field, rowId);
                } else if (e.key === 'Escape') {
                    cell.textContent = originalValue;
                }
            });
            
            // حفظ التغييرات عند فقدان التركيز
            input.addEventListener('blur', function() {
                finishEditing(cell, input.value, field, rowId);
            });
        }
        
        // إنهاء تحرير الخلية
        function finishEditing(cell, newValue, field, rowId) {
            cell.textContent = newValue;
            
            // تحديث بيانات المنتج في المصفوفة
            const productIndex = products.findIndex(p => p.id === rowId);
            if (productIndex !== -1) {
                products[productIndex][field] = newValue;
                
                // تحديث القيم الحسابية إذا لزم الأمر
                if (field === 'price' || field === 'quantity') {
                    updateRowTotal(cell.closest('tr'));
                    
                    // إعادة حساب المجموع في بيانات المنتج
                    const price = parseFloat(products[productIndex].price) || 0;
                    const quantity = parseInt(products[productIndex].quantity) || 0;
                    products[productIndex].total = (price * quantity).toFixed(2);
                }
            }
            
            updateFullSheetTable();
            calculateGrandTotal();
            saveDataToStorage();
        }
        
        // تحديث المجموع للصف
        function updateRowTotal(row) {
            const priceCell = row.querySelector('[data-field="price"]');
            const quantityCell = row.querySelector('[data-field="quantity"]');
            const totalCell = row.querySelector('[data-field="total"]');
            
            const price = parseFloat(priceCell.textContent) || 0;
            const quantity = parseInt(quantityCell.textContent) || 0;
            const total = price * quantity;
            
            totalCell.textContent = total.toFixed(2);
        }
        
        // تحديث أرقام الصفوف
        function updateRowNumbers() {
            const rows = document.querySelectorAll('#tableBody tr');
            rows.forEach((row, index) => {
                row.cells[0].textContent = index + 1;
            });
        }
        
        // تهيئة الماسح الضوئي
        function initScanner() {
            html5QrCode = new Html5Qrcode("reader");
            
            document.getElementById('startScannerBtn').addEventListener('click', startScanner);
            document.getElementById('stopScannerBtn').addEventListener('click', stopScanner);
        }
        
        // بدء المسح الضوئي
        function startScanner() {
            const qrCodeSuccessCallback = (decodedText, decodedResult) => {
                if (scannerActive) {
                    stopScanner();
                    
                    // التحقق من صحة النص الممسوح
                    if (!decodedText || decodedText.trim() === '') {
                        // خطأ في الكود
                        handleScanError('Invalid or empty barcode');
                        return;
                    }
                    
                    // إضافة المنتج
                    addProductFromScan(decodedText);
                    
                    // إعادة تشغيل الماسح بعد ثانيتين
                    setTimeout(() => {
                        if (!scannerActive) {
                            startScanner();
                        }
                    }, 2000);
                }
            };
            
            const qrCodeErrorCallback = (errorMessage) => {
                // تجاهل أخطاء المسح المتكررة
                if (errorMessage.includes("NotFoundException") || 
                    errorMessage.includes("NoMultiFormatReader")) {
                    return;
                }
                
                // معالجة أخطاء المسح الأخرى
                console.log(`QR Code Error: ${errorMessage}`);
            };
            
            const config = { 
                fps: 10, 
                qrbox: { width: 250, height: 250 },
                supportedScanTypes: [Html5QrcodeScanType.SCAN_TYPE_CAMERA],
                formatsToSupport: [
                    Html5QrcodeSupportedFormats.UPC_A,
                    Html5QrcodeSupportedFormats.UPC_E,
                    Html5QrcodeSupportedFormats.UPC_EAN_EXTENSION,
                    Html5QrcodeSupportedFormats.EAN_8,
                    Html5QrcodeSupportedFormats.EAN_13,
                    Html5QrcodeSupportedFormats.CODE_128,
                    Html5QrcodeSupportedFormats.CODE_39,
                    Html5QrcodeSupportedFormats.CODE_93,
                    Html5QrcodeSupportedFormats.QR_CODE
                ]
            };
            
            html5QrCode.start(
                { facingMode: "environment" }, 
                config, 
                qrCodeSuccessCallback,
                qrCodeErrorCallback
            )
            .then(() => {
                scannerActive = true;
                document.getElementById('scannerResult').textContent = 'Scanning...';
                document.getElementById('scannerResult').style.color = 'var(--accent-color)';
                showMessage('Scanner started successfully', 'success');
            })
            .catch(err => {
                console.error("Scanner start error:", err);
                showMessage('Failed to start scanner. Please check camera permissions.', 'error');
                handleScanError('Scanner initialization failed');
            });
        }
        
        // معالجة خطأ المسح
        function handleScanError(errorMessage) {
            // تشغيل صوت الخطأ
            playErrorSound();
            
            // تفعيل ضوء الخطأ
            activateErrorLight();
            
            // عرض رسالة الخطأ
            document.getElementById('scannerResult').textContent = `Error: ${errorMessage}`;
            document.getElementById('scannerResult').style.color = 'var(--danger-color)';
            
            // إعادة تشغيل الماسح بعد 3 ثوانٍ
            setTimeout(() => {
                if (!scannerActive) {
                    startScanner();
                }
            }, 3000);
        }
        
        // إيقاف المسح الضوئي
        function stopScanner() {
            if (scannerActive) {
                html5QrCode.stop()
                    .then(() => {
                        scannerActive = false;
                        document.getElementById('scannerResult').textContent = 'Scanner stopped';
                        document.getElementById('scannerResult').style.color = 'var(--danger-color)';
                    })
                    .catch(err => {
                        console.error("Scanner stop error:", err);
                    });
            }
        }
        
        // إضافة منتج من المسح الضوئي
        function addProductFromScan(code) {
            // تنظيف وتنسيق الكود
            const cleanedCode = code.trim();
            
            // البحث عما إذا كان المنتج موجودًا بالفعل
            const existingRow = Array.from(document.querySelectorAll('#tableBody [data-field="code"]'))
                .find(cell => cell.textContent === cleanedCode);
            
            if (existingRow) {
                // زيادة الكمية إذا كان المنتج موجودًا
                const row = existingRow.closest('tr');
                const quantityCell = row.querySelector('[data-field="quantity"]');
                const currentQty = parseInt(quantityCell.textContent) || 0;
                quantityCell.textContent = currentQty + 1;
                updateRowTotal(row);
                
                // تحديث بيانات المنتج في المصفوفة
                const rowId = parseInt(row.cells[0].textContent);
                const productIndex = products.findIndex(p => p.id === rowId);
                if (productIndex !== -1) {
                    products[productIndex].quantity = currentQty + 1;
                    const price = parseFloat(products[productIndex].price) || 0;
                    products[productIndex].total = (price * (currentQty + 1)).toFixed(2);
                }
                
                // تأثيرات التكرار
                playDuplicateSound();
                activateDuplicateLight();
                
                // تأثير تمييز
                row.classList.add('highlight');
                setTimeout(() => row.classList.remove('highlight'), 1500);
                
                document.getElementById('scannerResult').textContent = `Duplicate: ${cleanedCode} - Quantity increased`;
                document.getElementById('scannerResult').style.color = 'var(--warning-color)';
                
                showMessage('Product quantity increased', 'warning');
            } else {
                // إضافة منتج جديد مع بيانات افتراضية
                const newProduct = {
                    id: rowCounter++,
                    code: cleanedCode,
                    name: 'New Product', // سيتم تعديله يدويًا
                    price: '0.00', // سيتم إدخاله يدويًا
                    quantity: 1, // سيتم تعديله تلقائيًا
                    total: '0.00'
                };
                
                newProduct.total = (parseFloat(newProduct.price) * newProduct.quantity).toFixed(2);
                products.push(newProduct);
                
                addRowToTable(newProduct);
                
                // تأثيرات النجاح
                playSuccessSound();
                activateSuccessLight();
                
                document.getElementById('scannerResult').textContent = `Success: ${cleanedCode} - New product added`;
                document.getElementById('scannerResult').style.color = 'var(--success-color)';
                
                showMessage('New product added', 'success');
            }
            
            updateFullSheetTable();
            calculateGrandTotal();
            saveDataToStorage();
        }
        
        // إضافة صف إلى الجدول
        function addRowToTable(product, saveToStorage = true) {
            const tableBody = document.getElementById('tableBody');
            const newRow = document.createElement('tr');
            
            newRow.innerHTML = `
                <td>${product.id}</td>
                <td class="editable" data-field="code">${product.code}</td>
                <td class="editable" data-field="name">${product.name}</td>
                <td class="editable" data-field="price">${product.price}</td>
                <td class="editable" data-field="quantity">${product.quantity}</td>
                <td data-field="total">${product.total}</td>
                <td class="actions-cell">
                    <button class="action-btn edit" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn delete" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            
            tableBody.appendChild(newRow);
            updateRowNumbers();
            
            if (saveToStorage) {
                saveDataToStorage();
            }
        }
        
        // تحديث جدول البيانات الكامل
        function updateFullSheetTable() {
            const fullSheetBody = document.getElementById('fullSheetBody');
            fullSheetBody.innerHTML = '';
            
            // جمع البيانات من الجدول الرئيسي
            const rows = document.querySelectorAll('#tableBody tr');
            rows.forEach(row => {
                const newRow = document.createElement('tr');
                
                newRow.innerHTML = `
                    <td>${row.cells[0].textContent}</td>
                    <td>${row.cells[1].textContent}</td>
                    <td>${row.cells[2].textContent}</td>
                    <td>General</td>
                    <td>${row.cells[3].textContent}</td>
                    <td>${row.cells[4].textContent}</td>
                    <td>${row.cells[5].textContent}</td>
                    <td class="actions-cell">
                        <button class="action-btn delete" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                fullSheetBody.appendChild(newRow);
            });
        }
        
        // حساب المجموع الكلي
        function calculateGrandTotal() {
            const totalCells = document.querySelectorAll('[data-field="total"]');
            let grandTotal = 0;
            
            totalCells.forEach(cell => {
                grandTotal += parseFloat(cell.textContent) || 0;
            });
            
            document.getElementById('grandTotal').textContent = grandTotal.toFixed(2);
            saveDataToStorage();
        }
        
        // تهيئة الأزرار
        function initButtons() {
            // إضافة صف
            document.getElementById('addRowBtn').addEventListener('click', addNewRow);
            document.getElementById('addRowSheetBtn').addEventListener('click', addNewRow);
            
            // إضافة يدويًا
            document.getElementById('addManualBtn').addEventListener('click', function() {
                const productCode = prompt('Enter product code (barcode):');
                if (productCode) {
                    // تشغيل صوت النجاح (إضافة يدوية)
                    if (soundsEnabled) {
                        playSuccessSound();
                    }
                    
                    // تفعيل ضوء النجاح (إضافة يدوية)
                    if (lightsEnabled) {
                        activateSuccessLight();
                    }
                    
                    addProductFromScan(productCode);
                }
            });
            
            // حفظ البيانات يدويًا
            document.getElementById('saveDataBtn').addEventListener('click', function() {
                if (saveDataToStorage()) {
                    showMessage('Data saved successfully', 'success');
                }
            });
            
            // مسح الكل
            document.getElementById('clearAllBtn').addEventListener('click', function() {
                if (confirm('Delete all products? This action cannot be undone.')) {
                    document.getElementById('tableBody').innerHTML = '';
                    products = [];
                    rowCounter = 1;
                    updateFullSheetTable();
                    calculateGrandTotal();
                    saveDataToStorage();
                    showMessage('All products deleted', 'success');
                }
            });
            
            // تصدير الجدول
            document.getElementById('exportBtn').addEventListener('click', exportTable);
            
            // إنشاء روابط المشاركة
            document.getElementById('generateLinksBtn').addEventListener('click', generateShareLinks);
            
            // نسخ الروابط
            document.getElementById('copyJsonBtn').addEventListener('click', function() {
                copyToClipboard('jsonLink');
            });
            
            document.getElementById('copyCsvBtn').addEventListener('click', function() {
                copyToClipboard('csvLink');
            });
            
            // حفظ كملف
            document.getElementById('saveToFileBtn').addEventListener('click', saveTableToFile);
            
            // فتح في Google Sheets
            document.getElementById('openGoogleSheetsBtn').addEventListener('click', openInGoogleSheets);
            
            // حساب الإجمالي
            document.getElementById('calculateTotalBtn').addEventListener('click', calculateGrandTotal);
            
            // حفظ البيانات عند إغلاق الصفحة
            window.addEventListener('beforeunload', function() {
                saveDataToStorage();
            });
        }
        
        // إضافة صف جديد
        function addNewRow() {
            const newProduct = {
                id: rowCounter++,
                code: `NEW${Date.now().toString().slice(-6)}`,
                name: 'New Product',
                price: '0.00',
                quantity: '1',
                total: '0.00'
            };
            
            addRowToTable(newProduct);
            updateFullSheetTable();
            calculateGrandTotal();
            showMessage('New row added', 'success');
        }
        
        // تصدير الجدول
        function exportTable() {
            const rows = [];
            const header = ['#', 'Product Code', 'Product Name', 'Price', 'Quantity', 'Total'];
            rows.push(header.join(','));
            
            const tableRows = document.querySelectorAll('#tableBody tr');
            tableRows.forEach(row => {
                const rowData = [
                    row.cells[0].textContent,
                    row.cells[1].textContent,
                    row.cells[2].textContent,
                    row.cells[3].textContent,
                    row.cells[4].textContent,
                    row.cells[5].textContent
                ];
                rows.push(rowData.join(','));
            });
            
            const csvContent = rows.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'products_' + new Date().toISOString().slice(0, 10) + '.csv');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showMessage('Table exported successfully', 'success');
        }
        
        // إنشاء روابط المشاركة
        function generateShareLinks() {
            const tableData = getTableData();
            const jsonData = JSON.stringify(tableData);
            const csvData = convertToCSV(tableData);
            
            // في تطبيق حقيقي، هنا يتم رفع البيانات إلى خادم والحصول على روابط حقيقية
            // لكننا سنقوم بمحاكاة ذلك
            
            const baseUrl = window.location.href.split('#')[0];
            document.getElementById('jsonLink').value = `${baseUrl}#data=${btoa(jsonData)}`;
            document.getElementById('csvLink').value = `${baseUrl}#csv=${btoa(csvData)}`;
            
            showMessage('Share links generated successfully', 'success');
        }
        
        // الحصول على بيانات الجدول
        function getTableData() {
            const tableData = [];
            const rows = document.querySelectorAll('#tableBody tr');
            
            rows.forEach(row => {
                tableData.push({
                    id: row.cells[0].textContent,
                    code: row.cells[1].textContent,
                    name: row.cells[2].textContent,
                    price: row.cells[3].textContent,
                    quantity: row.cells[4].textContent,
                    total: row.cells[5].textContent
                });
            });
            
            return tableData;
        }
        
        // تحويل إلى CSV
        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const rows = data.map(row => 
                headers.map(header => JSON.stringify(row[header])).join(',')
            );
            
            return [headers.join(','), ...rows].join('\n');
        }
        
        // نسخ إلى الحافظة
        function copyToClipboard(inputId) {
            const input = document.getElementById(inputId);
            input.select();
            input.setSelectionRange(0, 99999);
            
            navigator.clipboard.writeText(input.value)
                .then(() => {
                    showMessage('Link copied to clipboard', 'success');
                })
                .catch(err => {
                    console.error('Failed to copy link: ', err);
                    showMessage('Failed to copy link', 'error');
                });
        }
        
        // حفظ الجدول كملف
        function saveTableToFile() {
            const tableData = getTableData();
            const jsonData = JSON.stringify(tableData, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'products_' + new Date().toISOString().slice(0, 10) + '.json');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showMessage('Table saved as JSON file', 'success');
        }
        
        // فتح في Google Sheets (محاكاة)
        function openInGoogleSheets() {
            showMessage('Opening in Google Sheets. In a real app, data would be uploaded to Google Sheets.', 'success');
            
            // محاكاة التأخير
            setTimeout(() => {
                const tableData = getTableData();
                const csvData = convertToCSV(tableData);
                const encodedData = encodeURIComponent(csvData);
                
                // رابط Google Sheets لإنشاء جدول جديد
                const googleSheetsUrl = `https://docs.google.com/spreadsheets/create?usp=sharing&data=${encodedData}`;
                
                // فتح نافذة جديدة
                window.open(googleSheetsUrl, '_blank');
            }, 1000);
        }
        
        // عرض الرسائل
        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            
            // إخفاء الرسالة بعد 3 ثوانٍ
            setTimeout(() => {
                messageEl.className = 'message';
            }, 3000);
        }
        
        // عرض إشعار صغير
        function showNotification(text, type) {
            const notification = document.getElementById('notification');
            notification.textContent = text;
            notification.className = `notification ${type} show`;
            
            // إخفاء الإشعار بعد 3 ثوانٍ
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
